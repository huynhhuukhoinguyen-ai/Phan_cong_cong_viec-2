import tkinter as tk
from tkinter import ttk, messagebox
import os

# ===== C·ª¨A S·ªî CH√çNH =====
root = tk.Tk()
root.title("B·∫£ng ph√¢n c√¥ng c√¥ng vi·ªác")
root.geometry("1050x420")

# ===== B·∫¢NG =====
columns = ("congviec", "thanhvien", "deadline", "ghichu", "tiendo", "link")
tree = ttk.Treeview(root, columns=columns, show="headings")

tree.heading("congviec", text="C√¥ng vi·ªác")
tree.heading("thanhvien", text="T√™n th√†nh vi√™n")
tree.heading("deadline", text="Deadline")
tree.heading("ghichu", text="Ghi ch√∫")
tree.heading("tiendo", text="Ti·∫øn ƒë·ªô")
tree.heading("link", text="Link b√†i")

tree.column("congviec", width=150)
tree.column("thanhvien", width=260)
tree.column("deadline", width=120)
tree.column("ghichu", width=120)
tree.column("tiendo", width=140)
tree.column("link", width=100)

tree.pack(fill="both", expand=True)

# ===== D·ªÆ LI·ªÜU =====
data_full = [
    {
        "congviec": "B√†i thuy·∫øt tr√¨nh",
        "thanhvien": "Nguy√™n\nTr·∫ßn Ki·ªÅu Oanh\nƒê√†o Ph∆∞∆°ng Nh∆∞\nV√µ T·∫•n Qu√Ω",
        "deadline": "22h 20/01",
        "ghichu": "N·ªôi dung chi ti·∫øt b√†i thuy·∫øt tr√¨nh",
        "tiendo": "ƒêang l√†m",
        "link": "bai_thuyet_trinh.docx"
    },
    {
        "congviec": "B√†i ki·ªÉm tra s·ªë 1",
        "thanhvien": "Nguy·ªÖn Xu√¢n Qu·ª≥nh\nD∆∞∆°ng Thi√™n Ph√°t",
        "deadline": "22h 20/01",
        "ghichu": "N·ªôi dung chi ti·∫øt b√†i ki·ªÉm tra s·ªë 1",
        "tiendo": "ƒêang l√†m",
        "link": "bai_kiem_tra_1.docx"
    },
    {
        "congviec": "B√†i ki·ªÉm tra gi·ªØa k·ª≥",
        "thanhvien": "Th√†nh Nh√¢n\nD∆∞∆°ng Anh Ph∆∞∆°ng",
        "deadline": "22h 22/01",
        "ghichu": "N·ªôi dung chi ti·∫øt b√†i ki·ªÉm tra gi·ªØa k·ª≥",
        "tiendo": "ƒêang l√†m",
        "link": "bai_giua_ky.docx"
    },
    {
        "congviec": "B√†i thu ho·∫°ch",
        "thanhvien": "Nguy·ªÖn Ng·ªçc Lan Nhi\nNguy·ªÖn Nh∆∞ Qu·ª≥nh\nNg·ª•y Tri·ªáu Ph√°t",
        "deadline": "22h 28/01",
        "ghichu": "N·ªôi dung chi ti·∫øt b√†i thu ho·∫°ch",
        "tiendo": "ƒêang l√†m",
        "link": "bai_thu_hoach.docx"
    }
]

# ===== ƒê·ªî D·ªÆ LI·ªÜU V√ÄO B·∫¢NG =====
for item in data_full:
    short_member = item["thanhvien"].split("\n")[0] + ", ..."
    tree.insert(
        "",
        tk.END,
        values=(
            item["congviec"],
            short_member,
            item["deadline"],
            "Xem chi ti·∫øt",
            item["tiendo"],
            "M·ªü file"
        )
    )

# ===== M·ªû FILE WORD =====
def open_file(path):
    if os.path.exists(path):
        os.startfile(path)
    else:
        messagebox.showerror("L·ªói", "Kh√¥ng t√¨m th·∫•y file Word")

# ===== POPUP CHI TI·∫æT =====
def show_detail(event):
    selected = tree.selection()
    if not selected:
        return

    index = tree.index(selected[0])
    item = data_full[index]

    detail = tk.Toplevel(root)
    detail.title("Chi ti·∫øt c√¥ng vi·ªác")
    detail.geometry("460x380")

    tk.Label(detail, text="C√¥ng vi·ªác:", font=("Arial", 11, "bold")).pack(anchor="w", padx=10)
    tk.Label(detail, text=item["congviec"]).pack(anchor="w", padx=20)

    tk.Label(detail, text="\nTh√†nh vi√™n:", font=("Arial", 11, "bold")).pack(anchor="w", padx=10)
    tk.Label(detail, text=item["thanhvien"], justify="left").pack(anchor="w", padx=20)

    tk.Label(detail, text="\nDeadline:", font=("Arial", 11, "bold")).pack(anchor="w", padx=10)
    tk.Label(detail, text=item["deadline"]).pack(anchor="w", padx=20)

    tk.Label(detail, text="\nGhi ch√∫ chi ti·∫øt:", font=("Arial", 11, "bold")).pack(anchor="w", padx=10)
    note = tk.Text(detail, height=4, wrap="word")
    note.pack(fill="x", padx=20)
    note.insert("1.0", item["ghichu"])

    tk.Button(
        detail,
        text="M·ªü b√†i l√†m (Word)",
        command=lambda: open_file(item["link"])
    ).pack(pady=10)

# ===== MENU ƒê·ªîI TR·∫†NG TH√ÅI =====
menu = tk.Menu(root, tearoff=0)
current_item = {"row": None}

def set_status(status):
    row = current_item["row"]
    if row is None:
        return
    index = tree.index(row)
    data_full[index]["tiendo"] = status

    values = list(tree.item(row, "values"))
    values[4] = status
    tree.item(row, values=values)

def show_status_menu(event):
    row = tree.identify_row(event.y)
    col = tree.identify_column(event.x)

    # C·ªôt Ti·∫øn ƒë·ªô l√† c·ªôt th·ª© 5 (#5)
    if row and col == "#5":
        current_item["row"] = row
        menu.tk_popup(event.x_root, event.y_root)

menu.add_command(label="üîÑ ƒêang l√†m", command=lambda: set_status("ƒêang l√†m"))
menu.add_command(label="‚úÖ ƒê√£ ho√†n th√†nh", command=lambda: set_status("ƒê√£ ho√†n th√†nh"))

# ===== BIND S·ª∞ KI·ªÜN =====
tree.bind("<Double-1>", show_detail)     # double-click xem chi ti·∫øt
tree.bind("<Button-3>", show_status_menu)  # chu·ªôt ph·∫£i ƒë·ªïi tr·∫°ng th√°i

root.mainloop()
